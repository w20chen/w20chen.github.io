---
layout:     post
title:      text2handwriting
subtitle:   a trivial tool
date:       2022-08-19
author:     Chen
header-img: img/pexels-яна-кононцова-11140999.jpg
catalog:    true
tags:
    - Nonsense
---

## a trivial tool to convert text to handwriting

So your teacher asked you to upload written assignments? Hate writing assignments? This tool will help you convert your text to handwriting.   
Note: This tool can only handle English lowercase letters and common punctuation.     
The basic principle is nothing more than splicing letters together.     

Environment: python 3.x, openCV

### 第一步：resize alphabet pictures
保证每个字母单独成为一张图片。确保字母在各自的图片中处于同一高度。    
每个字符设计**多种写法**，增加随机性。    

```py
import cv2, os

width = 120
ls = os.listdir("./raw_font")

def resize_img(filename):
    img = cv2.imread(filename, cv2.IMREAD_GRAYSCALE)
    height = img.shape[0]
    dim = (width, height)
    resized = cv2.resize(img, dim, interpolation=cv2.INTER_AREA)
    cv2.imwrite("../font_/resized_" + filename, resized)

for filename in ls:
    if filename.split('.')[-1] == "png":
        resize_img(filename)
```

<img src="/img/alphabet.png" width=500 />


### 第二步：crop alphabet pictures
将字母图片修剪成同一大小，且不改变字母所在的高度。   

```py
height = 256          
def resize_img(filename):
    img = cv2.imread(filename, cv2.IMREAD_GRAYSCALE)
    H = img.shape[0]
    img = img[H // 2 - height // 2:H // 2 + height // 2, :]
    cv2.imwrite("../font/resized_" + filename, img)
```

### 第三步：splice letters together
在画布上拼接字母。   
So you have edited a set of pictures. Now you are splicing them together.

```py
import cv2, os, random
import numpy as np

class canvas:
    def __init__(self,
                 width=50,
                 height=128,
                 canvas_width=3000,
                 canvas_height=4000,
                 margin=200,
                 linespace=50):
        self.Width = width
        self.Height = height
        self.Margin = margin
        self.Linespace = linespace

        self.X = linespace
        self.Y = margin
        self.Canvas_width = canvas_width
        self.Canvas_height = canvas_height

        self.img = np.zeros((self.Canvas_height, self.Canvas_width), np.uint8)
        self.img.fill(255)

    def newline(self):
        self.Y = self.Margin
        self.X = self.X + self.Height + self.Linespace

    def draw(self, char):
        if self.X >= self.Canvas_height:
            return
        elif char == '\n':
            self.newline()
            return
        if char in alphabet:
            new_char = random.choice(alphabet[char])
            new_char = cv2.resize(new_char, (self.Width, self.Height),
                                  interpolation=cv2.INTER_AREA)
            for deltaX in range(self.Height):
                for deltaY in range(self.Width):
                    self.img[deltaX + self.X][deltaY + 
                        self.Y] = new_char[deltaX][deltaY]

        self.Y += self.Width
        if self.Y + self.Width >= self.Canvas_width:
            self.newline()

#########################################

f = open("./text.txt", mode='r')
text = f.read().lower()
f.close()
print("Text loaded.")
#########################################

alphabet = {}
ls = os.listdir("./font")
for filename in ls:
    key = filename.split('.')[-2][-2]
    new_img = cv2.imread("./font/" + filename, cv2.IMREAD_GRAYSCALE)

    if key not in alphabet:
        alphabet[key] = []
    alphabet[key].append(new_img)
    
print('Alphabet loaded.')
#########################################

alphabet[','] = [cv2.imread("./punctuations/1.png", cv2.IMREAD_GRAYSCALE)]
alphabet['"'] = [cv2.imread("./punctuations/2.png", cv2.IMREAD_GRAYSCALE)]
alphabet['.'] = [cv2.imread("./punctuations/3.png", cv2.IMREAD_GRAYSCALE)]
alphabet["'"] = [cv2.imread("./punctuations/4.png", cv2.IMREAD_GRAYSCALE)]
alphabet[';'] = [cv2.imread("./punctuations/5.png", cv2.IMREAD_GRAYSCALE)]
alphabet['!'] = [cv2.imread("./punctuations/6.png", cv2.IMREAD_GRAYSCALE)]
alphabet['-'] = [cv2.imread("./punctuations/7.png", cv2.IMREAD_GRAYSCALE)]
alphabet[':'] = [cv2.imread("./punctuations/8.png", cv2.IMREAD_GRAYSCALE)]
alphabet['?'] = [cv2.imread("./punctuations/9.png", cv2.IMREAD_GRAYSCALE)]
print("Punctuations loaded.")
#########################################

can = canvas(width=12,
             height=32,
             canvas_width=800,
             canvas_height=2000,
             margin=4,
             linespace=0)

for char in text:
    can.draw(char)

output = "output.png"
cv2.imwrite(output, can.img)
print(output + ' saved.')
```

### Results (handwriting generated by code)
##### a quick brown fox jumps over the lazy dog

<img src="/img/letter_demo.png" width=500 />


##### Pushkin's Poem
(handwriting generated by code)

<img src="/img/letter_output.png" width=415 />


### 更多：使用类似方法生成其他字体
The result of "**edehoifcehnoicerwjfocwpqhoevnfrwovwnvrwovmprenvprwibfwpfbwasmmrvbddrp**"     
<img src="/img/goth.png" width=700 />
